.INCLUDE "M2560DEF.INC"
.ORG 0X0100

JMP MAIN

SLENGTH:
	PUSH R17
	PUSH R18

	IN R26, SPL
	IN R27, SPH

	LDI R18, 0 // COUNTER
	RET

AGAIN:
	LD R17, X+
	CPI R17, 0
	BREQ RETURN
	INC R18
	JMP AGAIN

RETURN:
	RET



//----------------------------
// INPUT PARAMETERS: 
// Z: IS A POINTER TO THE STRING

str_length:
	PUSH R16
	PUSH R17
	PUSH R26
	PUSH R27
	PUSH R28
	PUSH R29
//	PUSH R30
//	PUSH R31

	IN R26, SPL // R26:R27 IS AN X POINTER
	IN R27, SPH
	ADIW R26, 0X0A
	
	LDI R17, 0X00  // COUNTER

NEXT:
	LPM R16, Z	// CZYTAJ Z PAMIECI FLASH
	CPI R16, 0X00 
	BREQ ZERO
	INC R17		// INCREMENT THE COUNTER
	INC R30	 	// INC NIE USTAWIA FLAGI 'C'
	BRNE NEXT 
	INC R31
	JMP NEXT

ZERO:
	ST X, R17 // RETURN THE COUNT NUMBER

//	POP R31
//	POP R30
	POP R29
	POP R28
	POP R27
	POP R26
	POP R17
	POP R16
	RET

// http://www.cse.unsw.edu.au/~cs3221/Labs/Experiment2.pdf

MAIN:

STRING1: .DB 'H', 'E', 'L', 'L', 'O', 0X20, 0 
STRING2: .DB 'A', 'T', 'I', 'S', 0

	LDI ZH, HIGH(2*STRING1) ; Point Z to MYARRAY to samo co LDI ZL, LOW(MYARRAY<<1)
	LDI ZL, LOW(2*STRING1)

	PUSH R16
	RCALL str_length
	POP R16

	LDI ZH, HIGH(2*STRING2) ; Point Z to MYARRAY to samo co LDI ZL, LOW(MYARRAY<<1)
	LDI ZL, LOW(2*STRING2)

	PUSH R17
	RCALL str_length
	POP R17

	END:
	JMP END
